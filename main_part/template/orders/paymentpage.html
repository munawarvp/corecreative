{% load static %}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		 <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

		<title>Core Creative</title>
		<link rel="Icon" href="{% static 'images\Black White Simple Art Studio Logo.png' %} ">

 		<!-- Google font -->
 		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

 		<!-- Bootstrap -->
 		<link type="text/css" rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}"/>

 		<!-- Slick -->
 		<link type="text/css" rel="stylesheet" href="{% static 'css/slick.css' %}"/>
		<link type="text/css" rel="stylesheet" href="{% static 'css/slick-theme.css' %}"/>

 		<!-- nouislider -->
 		<link type="text/css" rel="stylesheet" href="{% static 'css/nouislider.min.css' %}"/>

 		<!-- Font Awesome Icon -->
 		<link rel="stylesheet" href="{% static 'css/nouislider.min.css' %}">

		<script src="https://kit.fontawesome.com/6819033383.js" crossorigin="anonymous"></script>

		<!-- payment  -->
		<script src="https://www.paypal.com/sdk/js?client-id=AXoJ_fYc5telCqACIxR1RpyTCsb-muwfTHDwDBSuYUY0fcAu7N64G2ad5JU09Nz9XAkQnPrrK9vKDkGC&currency=USD"></script>

 		<!-- Custom stlylesheet -->
 		<link type="text/css" rel="stylesheet" href="{% static 'css/style.css' %}"/>

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

    </head>
	<body>
		<!-- HEADER -->
		<header>
			<!-- TOP HEADER -->
			<div id="top-header">
				<div class="container">
					<ul class="header-links pull-left">
						<li><a href="#"><i class="fa fa-phone"></i>+91 7558916838</a></li>
						<li><a href="#"><i class="fa fa-envelope-o"></i> laserlad@gmail.com</a></li>
						<li><a href="#"><i class="fa fa-map-marker"></i> Calicut</a></li>
					</ul>
					<ul class="header-links pull-right">
						<li><a href="{% url 'my_account' %}"><i class="fa fa-user-o"></i> My Account</a></li>
					</ul>
				</div>
			</div>
			<!-- /TOP HEADER -->

			<!-- MAIN HEADER -->
			<div id="header">
				<!-- container -->
				<div class="container">
					<!-- row -->
					<div class="row">
						<!-- LOGO -->
						<div class="col-md-3">
							<div class="header-logo">
								<a href="{% url 'home' %}" class="logo">
									<img src="{% static 'images/Logo.png' %} " alt="">
								</a>
							</div>
						</div>
						<!-- /LOGO -->

						<!-- SEARCH BAR -->
						<div class="col-md-6">
							<div class="header-search">
								<form>
									<select class="input-select">
										<option value="0">All Categories</option>
										<option value="1">Category 01</option>
										<option value="1">Category 02</option>
									</select>
									<input class="input" placeholder="Search here">
									<button class="search-btn">Search</button>
								</form>
							</div>
						</div>
						<!-- /SEARCH BAR -->

						<!-- ACCOUNT -->
						<div class="col-md-3 clearfix">
							<div class="header-ctn">
								<!-- Wishlist -->
								<div>
									<a href="{% url 'wishlist' %}">
										<i class="fa fa-heart-o"></i>
										<span>Your Wishlist</span>
										<div class="qty">{{wishlist_count}}</div>
									</a>
								</div>
								<!-- /Wishlist -->

								<!-- Cart -->
								<div class="dropdown">
									<a class="dropdown-toggle" href="{% url 'carts' %}" >
										<i class="fa fa-shopping-cart"></i>
										<span>Your Cart</span>
										<div class="qty">{{cart_count}}</div>
									</a>
								</div>
								<!-- /Cart -->

								<!-- Menu Toogle -->
								<div class="menu-toggle">
									<a href="#">
										<i class="fa fa-bars"></i>
										<span>Menu</span>
									</a>
								</div>
								<!-- /Menu Toogle -->
							</div>
						</div>
						<!-- /ACCOUNT -->
					</div>
					<!-- row -->
				</div>
				<!-- container -->
			</div>
			<!-- /MAIN HEADER -->
		</header>
		<!-- /HEADER -->

		<!-- NAVIGATION -->
		<nav id="navigation">
			<!-- container -->
			<div class="container">
				<!-- responsive-nav -->
				<div id="responsive-nav">
					<!-- NAV -->
					<ul class="main-nav nav navbar-nav">
						<li class="active"><a href="{% url 'home' %}">Home</a></li>
						<li><a href="{% url 'category' %}">Category</a></li>
						<li><a href="{% url 'store' %}">Products</a></li>
						<li><a href="#">Accessories</a></li>
						<li><a href="#">About Us</a></li>
					</ul>
					<!-- /NAV -->
				</div>
				<!-- /responsive-nav -->
			</div>
			<!-- /container -->
		</nav>
		<!-- /NAVIGATION -->

		<!-- BREADCRUMB -->
		<div id="breadcrumb" class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<div class="col-md-12">
						<h3 class="breadcrumb-header">Payment</h3>
						<ul class="breadcrumb-tree">
							<li><a href="{% url 'home' %}">Home</a></li>
							<li class="active">Payment</li>
						</ul>
					</div>
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /BREADCRUMB -->

		<!-- SECTION -->
		<div class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">

					<div class="col-md-7">
						<!-- Billing Details -->
						<div class="billing-details">
							<div class="card">
								<h4 class="card-header">Billing Address</h4>
								<div class="card-body">
								  <p class="card-text">{{order_details.user.first_name}} <br>
									{{order_details.address_line}} <br> 
									{{order_details.city}}, {{order_details.country}}, {{order_details.zipcode}} <br> 
									{{order_details.email}} <br>
									{{order_details.phone}}</p>
								</div>
							  </div>	
						</div>
						<!-- /Billing Details -->
						<hr>
						<!-- review products -->
						<div class="billing-details">
							<div class="card">
								<h4 class="card-header">Review Product</h4>
								<div class="card-body">
									<table class="table">
										<thead>
										  <tr>
											
											<th scope="col">Image</th>
											<th scope="col">Name</th>
											<th scope="col">Quantity</th>
										  </tr>
										</thead>
										<tbody>
										{% for cart_item in cart_items %}
										  <tr>
											<td><img style="width: 50px;" class="row-image" src="{{ cart_item.product.image.url }}" alt=""></td>
											<td><h5>{{cart_item.product.product_name}}</h5></td>
											<td>x {{cart_item.quantity}}</td>
										  </tr>
										{% endfor %}
										</tbody>
									  </table>
								</div>
							  </div>	
						</div>
						<!-- review products -->
						
					</div>

					<!-- Order Details -->
					<div class="col-md-5 order-details">
						<div class="section-title text-center">
							<h3 class="title">Your Order Total</h3>
						</div>
						<div class="order-summary">
							<div class="order-col">
								<div><strong>TOTAL</strong></div>
								<div><strong class="order-total">{{grand_total|floatformat:2}}â‚¹</strong></div>
							</div>
						</div>
						
						
						<div id="paypal-button-container">

						</div>
						
					</div>
					<!-- /Order Details -->
				</form>
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /SECTION -->

		<!-- FOOTER -->
		<footer id="footer">
			<!-- top footer -->
			<div class="section">
				<!-- container -->
				<div class="container">
					<!-- row -->
					<div class="row">
						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">About Us</h3>
								<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut.</p>
								<ul class="footer-links">
									<li><a href="#"><i class="fa fa-map-marker"></i>1734 Stonecoal Road</a></li>
									<li><a href="#"><i class="fa fa-phone"></i>+021-95-51-84</a></li>
									<li><a href="#"><i class="fa fa-envelope-o"></i>email@email.com</a></li>
								</ul>
							</div>
						</div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Categories</h3>
								<ul class="footer-links">
									<li><a href="#">Hot deals</a></li>
									<li><a href="#">Laptops</a></li>
									<li><a href="#">Smartphones</a></li>
									<li><a href="#">Cameras</a></li>
									<li><a href="#">Accessories</a></li>
								</ul>
							</div>
						</div>

						<div class="clearfix visible-xs"></div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Information</h3>
								<ul class="footer-links">
									<li><a href="#">About Us</a></li>
									<li><a href="#">Contact Us</a></li>
									<li><a href="#">Privacy Policy</a></li>
									<li><a href="#">Orders and Returns</a></li>
									<li><a href="#">Terms & Conditions</a></li>
								</ul>
							</div>
						</div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Service</h3>
								<ul class="footer-links">
									<li><a href="#">My Account</a></li>
									<li><a href="#">View Cart</a></li>
									<li><a href="#">Wishlist</a></li>
									<li><a href="#">Track My Order</a></li>
									<li><a href="#">Help</a></li>
								</ul>
							</div>
						</div>
					</div>
					<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<!-- /top footer -->

			<!-- bottom footer -->
			<div id="bottom-footer" class="section">
				<div class="container">
					<!-- row -->
					<div class="row">
						<div class="col-md-12 text-center">
							<ul class="footer-payments">
								<li><a href="#"><i class="fa fa-cc-visa"></i></a></li>
								<li><a href="#"><i class="fa fa-credit-card"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-paypal"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-mastercard"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-discover"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-amex"></i></a></li>
							</ul>
							<span class="copyright">
								 <a target="_blank" href="https://www.templateshub.net">Templates Hub</a>
							</span>
						</div>
					</div>
						<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<!-- /bottom footer -->
		</footer>
		<!-- /FOOTER -->


		<!-- payment integration -->
		<script>

			function getCookie(name){
				let cookieValue = null;
				if(document.cookie && document.cookie !== ''){
					const cookies = document.cookie.split(';');
					for(let i = 0; i<cookies.length; i++){
						const cookie = cookies[i].trim();
						if (cookie.substring(0,name.length + 1) === (name + '=')) {
							cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
							break;
						}
					}
				}
				return cookieValue;
			}
			 

			var amount = "{{grand_total}}"
			var url = "{% url 'payment' %}"
			console.log(url)
			var csrftoken = getCookie('csrftoken');
			var orderID = "{{order_details.order_number}}"
			console.log(orderID)
			var payment_method = 'PayPal'
			var redirect_url = "{% url 'order_complete' %}"
			// Render the PayPal button into #paypal-button-container
			paypal.Buttons({

				style: {
					color:  'blue',
					shape:  'pill',
					label:  'pay',
					height: 40
				},
	
				// Set up the transaction
				createOrder: function(data, actions) {
					return actions.order.create({
						purchase_units: [{
							amount: {
								value: amount,
							}
						}]
					});
				},
	
				// Finalize the transaction
				onApprove: function(data, actions) {
					return actions.order.capture().then(function(orderData) {
						// Successful capture! For demo purposes:
						console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
						var transaction = orderData.purchase_units[0].payments.captures[0];
						console.log(orderData);
						alert('Transaction '+ transaction.status + ': ' + transaction.id + '\n\nSee console for all available details');
						sendData();
						function sendData(){
							fetch(url, {
								method : "POST",
								headers: {
									"Content-Type": "application/json",
									"X-CSRFToken": csrftoken,
								},
								body: JSON.stringify({
									orderID: orderID,
									transID: orderData.id,
									payment_method: payment_method,
									status: orderData.status,

								}),
							})
							.then((response) => response.json())
							.then((data) => {
								window.location.href = redirect_url + '?order_number='+data.order_number + '&payment_id='+data.transID;
							});
						}
	
						// Replace the above to show a success message within this page, e.g.
						// const element = document.getElementById('paypal-button-container');
						// element.innerHTML = '';
						// element.innerHTML = '<h3>Thank you for your payment!</h3>';
						// Or go to another URL:  actions.redirect('thank_you.html');
					});
				}
	
	
			}).render('#paypal-button-container');
		</script>

		

		<!-- payment-integration -->

		<!-- jQuery Plugins -->
		<script src="{% static 'js/jquery.min.js' %}"></script>
		<script src="{% static 'js/bootstrap.min.js' %}"></script>
		<script src="{% static 'js/slick.min.js' %}"></script>
		<script src="../static/js/nouislider.min.js"></script>
		<script src="../static/js/jquery.zoom.min.js"></script>
		<script src="../static/js/main.js"></script>

		

	</body>
</html>
